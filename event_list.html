{% extends 'base.html' %}
{% load static %}

{% block body_class %}bg-cover{% endblock %}

{% block extra_head %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  const imgs = [
    "{% static 'images/event_bg1.jpg' %}",
    "{% static 'images/event_bg2.jpg' %}",
    "{% static 'images/event_bg3.jpg' %}"
  ];
  const chosen = imgs[Math.floor(Math.random()*imgs.length)];
  setBodyBackground(chosen);  // <-- auto contrast + background
});
</script>
{% endblock %}

{% block content %}
<div class="surface p-4 mb-4">
  <h2 class="mb-3">Events</h2>

  <form class="row g-2 mb-3 filter-bar" method="get">
    <div class="col-md-6">
      <input class="form-control" name="q" value="{{ request.GET.q }}" placeholder="Search title/location">
    </div>
    <div class="col-md-3">
      <select class="form-select" name="when">
        <option value="">All</option>
        <option value="upcoming" {% if request.GET.when == 'upcoming' %}selected{% endif %}>Upcoming</option>
        <option value="past" {% if request.GET.when == 'past' %}selected{% endif %}>Past</option>
      </select>
    </div>
    <div class="col-md-3">
      <button class="btn btn-secondary w-100"><i class="bi bi-funnel"></i> Filter</button>
    </div>
  </form>

  <ul class="list-group">
    {% for e in events %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <a href="{% url 'event_detail' e.id %}" class="fw-bold">{{ e.title }}</a>
          {% if e.is_private %}<span class="badge bg-warning text-dark ms-2">Private</span>{% endif %}
          <br><small class="text-muted"><i class="bi bi-geo-alt"></i> {{ e.location|default:"â€”" }}</small>
        </div>
        <div class="text-end">
          <small class="text-muted">
            <i class="bi bi-calendar-event"></i>
            {{ e.date }} {{ e.time }}
          </small>
        </div>
      </li>
    {% empty %}
      <li class="list-group-item">No events found.</li>
    {% endfor %}
  </ul>
</div>
{% endblock %}
